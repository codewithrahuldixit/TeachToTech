<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Publish Articles - TeachToTech</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/TT.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Mentor
  * Template URL: https://bootstrapmade.com/mentor-free-education-bootstrap-theme/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
    .page-title {
  height: 200px; /* Adjust height as needed */
  display: flex;
  align-items: flex-start; /* Align content to the top */
  justify-content: center;
  padding-top: 10px; /* Add some spacing if needed */
}

.title-heading {
  margin: 0; /* Remove default margin for better positioning */
  font-size: 20px; /* Adjust font size as needed */
}
body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        background-color: #f4f4f4;
    }

    .form-container {
    width: 80%;
    max-width: 800px;
    background: white;
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 20px;
    margin: 10px auto; /* Centers the form horizontally */
    
}
#category{
  height: 50px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group label {
    font-weight: bold;
}

.form-group input[type="text"],
.form-group textarea { /* Increases size of both input and textarea */
    width: 100%;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 18px; /* Increases text size */
}

.form-group textarea {
    height: 200px; /* Increases the height of the content box */
    resize: vertical; /* Allows users to resize the textarea */
}
.form-group-2 {
    display: flex;
    justify-content: center; /* Centers the button */
    gap: 20px;
}

.form-group-2 button {
    align-self: center;
    padding: 12px 24px;
    background-color: #5fcf80;
    color: white;
    border: none;
    font-size: 18px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    border-radius: 4px;
}

.form-group button:hover {
    background-color: #4caf6f;
}
.preview-button{
  color:white;
}
.preview-button:active,
.preview-button:focus {
    background-color: #5fcf80;
    color: white;
    outline: none;
}

.sidebar {
    width: 280px;
    background-color: #5fcf80;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    flex-shrink: 0;
    }
    
    .nav-link {
        color: white;
    }
    .sidebar .nav-link {
    border-radius: 4px;
    transition: all 0.3s ease;
}


    
.sidebar .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
    .article-list {
        margin-left: 15px;
    }
    
    .article-list.active {
        display: block; /* Show when active */
    }
    .main-content {
    flex: 1;
    padding: 20px 30px;
    background-color: #f8f9fa;
    overflow-y: auto;
}

.page-title {
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 1px solid #dee2e6;
}

.title-heading {
    font-size: 2rem;
    font-weight: 700;
    color: #212529;
}

.article-content {
    background-color: white;
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    min-height: 300px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .d-flex {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
        max-height: 300px;
    }
    
    .main-content {
        padding: 15px;
    }
}

.hover-highlight:hover {
    color: white !important;
    text-decoration: underline !important;
}
    
    .main {
        margin-left: 20px;
        padding: 20px;
        width: 100%;
    }
    .hover-highlight:hover {
    color: white !important;
    text-decoration: underline !important;
}
.buttons{
    margin-left: 400px;
}

  </style>
  
</head>

<body class="events-page">

  <div th:replace="header2 :: header"></div>

  <!-- Sidebar (Discover Articles) -->
  <div class="d-flex">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="d-flex flex-column w-100 p-3">
            <a class="navbar-brand text-white fw-bold mb-3" href="#"> Notes</a>

            <!-- Loop through categories -->
            <ul class="nav flex-column w-100 p-0 m-0">
                <li class="nav-item w-100" th:each="category : ${categories}">
                    <a class="nav-link text-white d-flex align-items-center justify-content-between px-3 py-2 w-100"
                       href="javascript:void(0)" 
                       th:onclick="'fetchArticles(' + ${category.categoryId} + ')'">
                        <span th:text="${category.name}" class="category-name" th:data-category-id="${category.categoryId}"></span>
                        <i class="fas fa-plus"></i>
                    </a>

                    <!-- Articles list with correct ID format -->
                    <ul th:id="'articles-list-' + ${category.categoryId}" class="articles-list list-unstyled ps-3" 
                        th:data-category-id="${category.categoryId}" style="display:none;">
                        <!-- Articles will be populated here via JavaScript -->
                    </ul>

                    <hr class="w-100 m-0" style="border: none; height: 1px; background-color: #333;">
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content Area (Expanded) -->
    <main class="main-content">
        <!-- Page Title -->
        <div class="page-title" data-aos="fade">
            <div class="heading">
                <div class="container">
                    <div class="row d-flex justify-content-center text-center">
                        <div class="col-lg-12">
                            <h1 class="title-heading" th:text="${selectedArticle != null ? selectedArticle.title : 'Select an Article'}"></h1>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Article Content -->
        <section id="events" class="events section">
            <div class="article-content">
                <div th:if="${selectedArticle != null}">
                    <div th:utext="${selectedArticle.content}"></div>
                    
                    <!-- Action Buttons -->
                   
                </div>
                <div th:unless="${selectedArticle != null}" class="text-center text-muted">
                    <i class="fas fa-book fa-3x mb-3"></i>
                    <h3>Click on an topic to view its content</h3>
                    <p class="lead">Select a category from the sidebar to see available notes</p>
                </div>
            </div>
            <div th:if="${selectedArticle != null}" class="d-flex gap-3 mt-4 buttons">
                <button class="btn btn-warning text-white adminSection">Edit</button>
                <button class="btn btn-danger adminSection">Delete</button>
            </div>
        </section>
    </main>
    
</div>
  


  <!-- Main Content (Shifted Right) -->
  

  <div th:replace="footer :: footer"></div>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add click listeners to all category elements
        document.querySelectorAll('.nav-link').forEach(categoryElement => {
            categoryElement.addEventListener('click', function() {
                // Toggle the visibility of articles list
                const categoryId = this.querySelector('.category-name').getAttribute('data-category-id');
                const articlesList = document.getElementById(`articles-list-${categoryId}`);
                
                // Toggle icon
                const icon = this.querySelector('i');
                if (articlesList.style.display === 'none') {
                    articlesList.style.display = 'block';
                    icon.classList.remove('fa-plus');
                    icon.classList.add('fa-minus');
                } else {
                    articlesList.style.display = 'none';
                    icon.classList.remove('fa-minus');
                    icon.classList.add('fa-plus');
                }
                
                fetchArticles(categoryId);
            });
        });
    });
    
    function fetchArticles(categoryId) {
        console.log(`Fetching articles for categoryId: ${categoryId}`);
        fetch(`/articlesByCategory?categoryId=${categoryId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(articles => {
                // Find the articles list for this category
                const articlesList = document.getElementById(`articles-list-${categoryId}`);
                
                if (!articlesList) {
                    console.error(`Could not find articles list element for category ID ${categoryId}`);
                    return;
                }
                
                // Clear previous articles
                articlesList.innerHTML = "";
                
                if (articles.length === 0) {
                    articlesList.innerHTML = "<li class='text-muted'>No articles found</li>";
                    return;
                }
    
                // Add new articles
                articles.forEach(article => {
                    let articleItem = document.createElement("li");
                    articleItem.className = "article-item my-1";
                    articleItem.innerHTML = `
                        <a href="/discoverarticles?categoryId=${categoryId}&articleId=${article.id}" 
                           class="text-decoration-none text-white-50 hover-highlight">
                           ${article.title}
                        </a>`;
                    articlesList.appendChild(articleItem);
                });
                
                // Show the articles list
                articlesList.style.display = 'block';
            })
            .catch(error => {
                console.error("Error fetching articles:", error);
            });
    }
    function deletearticle(button, id){

button.disabled = true;
button.innerText = "Deleting...";

console.log("Deleting article with ID:", id);
if (!confirm("Are you sure you want to delete this article?")) {
  button.disabled = false;
    button.innerText = "Delete";
    return;
}
fetch(`/delete/${id}`,{
  method:"DELETE",
  headers: {
    "Content-Type":"application/json"
  }
})
.then(response=>response.text())
.then(message=>{
  alert(message);
  if(message.includes("successfully")){
    
   // button.closest("tr").remove();
    location.reload();
  }
  else{
    button.disabled=false;
    button.innerText="Delete";
  }
})
.catch(error => {
    console.error("Error deleting article:", error);
    button.disabled = false;
    button.innerText = "Delete"; 
});

}
    </script>
    
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Font Awesome (for icons) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

</body>
</html>

