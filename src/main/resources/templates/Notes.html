<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Notes - TeachToTech</title>
  <meta name="description" content="">
  <meta name="keywords" content="">

  <!-- Favicons -->
  <link href="assets/img/TT.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Main CSS File -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Mentor
  * Template URL: https://bootstrapmade.com/mentor-free-education-bootstrap-theme/
  * Updated: Aug 07 2024 with Bootstrap v5.3.3
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
  <style>
    .page-title {
  height: 200px; /* Adjust height as needed */
  display: flex;
  align-items: flex-start; /* Align content to the top */
  justify-content: center;
  padding-top: 10px; /* Add some spacing if needed */
}

.title-heading {
  margin: 0; /* Remove default margin for better positioning */
  font-size: 20px; /* Adjust font size as needed */
}
body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        background-color: #f4f4f4;
    }

#category{
  height: 50px;
}

.sidebar {
    width: 250px;
    background-color: #5fcf80;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    flex-shrink: 0;
    padding: 15px;
    }
    
    .nav-link {
        color: white;
    }
    .sidebar .nav-link {
    border-radius: 4px;
    transition: all 0.3s ease;
}


    
.sidebar .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1);
}
    .article-list {
        margin-left: 15px;
    }
    
    .article-list.active {
        display: block; /* Show when active */
    }
    .main-content {
    flex: 1;
    padding: 20px 30px;
    background-color: #f8f9fa;
    overflow-y: auto;
    width: 100%;
}

.page-title {
    margin-bottom: 10px;
    padding-bottom: 10px;
}

.title-heading {
    font-size: 2rem;
    font-weight: 800;
    color: #212529;
}

.article-content {
    background-color: white;
    width: 100%;  /* Adjust width */
    max-width: 1000px;  /* Prevent too large a box */
    padding: 10px;
    margin: 10px auto; /* Centering */
    text-align: center;
    height: 80vh;
}

.topic-item {
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.topic-content{
    text-align: left;
}
/* Responsive adjustments */
@media (max-width: 768px) {
    .d-flex {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
        max-height: 300px;
    }
    
    .main-content {
        padding: 15px;
    }
}

.hover-highlight:hover {
    color: white !important;
    text-decoration: underline !important;
}
    
    .main {
        margin-left: 20px;
        padding: 20px;
        width: 100%;
    }
    .hover-highlight:hover {
    color: white !important;
    text-decoration: underline !important;
}
.buttons{
    margin-left: 250px;
}
  </style>
  
</head>

<body class="events-page">

    <div th:replace="header2 :: header"></div>
  
    <!-- Sidebar (Discover Articles) -->
    <div class="d-flex"> 
      <!-- Sidebar --> 
      <nav class="sidebar"> 
          <div class="d-flex flex-column w-100 p-3"> 
              <a class="navbar-brand text-white fw-bold mb-3" href="#">Notes</a> 
   
              <!-- Categories will be loaded here via JavaScript --> 
              <ul class="nav flex-column w-100 p-0 m-0" id="categories-container">
                  <!-- This will be populated by JavaScript -->
                  <li class="loading-placeholder text-white">
                      <span><i class="fas fa-spinner fa-spin me-2"></i> Loading categories...</span>
                  </li>
              </ul> 
          </div> 
      </nav> 
   
      <!-- Main Content Area (Expanded) --> 
      <main class="main-content"> 
          <!-- Page Title --> 
          <div class="page-title" data-aos="fade"> 
              <div class="heading"> 
                  <div class="container"> 
                      <div class="row d-flex justify-content-center text-center"> 
                          <div class="col-lg-12"> 
                              <h1 class="title-heading">Select a Topic</h1> 
                          </div> 
                      </div> 
                  </div> 
              </div> 
          </div> 
   
          <!-- Article Content --> 
          <section id="events" class="events section"> 
              <div class="article-content">
                  <div class="text-center text-muted default-content"> 
                      <i class="fas fa-book fa-3x mb-3"></i> 
                      <h3>Click on a topic to view its content</h3> 
                      <p class="lead">Select a category from the sidebar to see available notes</p> 
                  </div>
                  <div class="topic-content" style="display: none;">
                      <!-- This will be populated via JavaScript -->
                      
                  </div>
              </div>

              <div class="d-flex gap-3 mt-2 buttons" style="display: none !important;">
                  <button class="btn btn-warning text-white adminSection edit-assignment-btn">Edit Assignment</button>
                  <button class="btn btn-warning text-white adminSection" onclick="onEditButtonClick()">Edit Notes</button> 
                  <button class="btn btn-danger adminSection">Delete Assignment</button> 
                  <button class="btn btn-danger adminSection">Delete Notes</button> 
              </div> 
          </section> 
      </main> 
       
  </div>
  <script>
   document.addEventListener('DOMContentLoaded', function() {
    // Fetch all categories when the page loads
    fetchCategories();

    // Function to fetch all categories
    function fetchCategories() {
        fetch('/category/getallcategory')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(categories => {
                displayCategories(categories);
            })
            .catch(error => {
                console.error('Error fetching categories:', error);
                document.getElementById('categories-container').innerHTML = `
                    <li class="text-white">
                        <span><i class="fas fa-exclamation-circle me-2"></i> Error loading categories</span>
                    </li>`;
            });
    }

    // Function to display categories in the sidebar
    function displayCategories(categories) {
        const categoriesContainer = document.getElementById('categories-container');
        
        if (categories.length === 0) {
            categoriesContainer.innerHTML = `
                <li class="text-white">
                    <span><i class="fas fa-info-circle me-2"></i> No categories found</span>
                </li>`;
            return;
        }

        let categoriesHTML = '';
        
        // Check the structure of your category objects and adjust accordingly
        categories.forEach(category => {
            // Log the category object to inspect its structure
            console.log('Category object:', category);
            
            // Make sure we're using the correct property name for the ID
            // It could be id, categoryId, _id, etc.
            const categoryId = category.id || category.categoryId || category._id;
            
            if (!categoryId) {
                console.error('Category ID is undefined for:', category);
                return;
            }
            
            categoriesHTML += `
                <li class="nav-item category-item">
                    <div class="d-flex align-items-center text-white category-header" data-category-id="${categoryId}">
                        <i class="fas fa-folder me-2"></i>
                        <span class="user-select-none">${category.name || category.categoryName || 'Unnamed Category'}</span>
                        <i class="fas fa-chevron-down ms-auto"></i>
                    </div>
                    <ul class="topics-container" id="topics-${categoryId}" style="display: none;">
                        <li class="loading-placeholder text-white ps-4">
                            <span><i class="fas fa-spinner fa-spin me-2"></i> Loading topics...</span>
                        </li>
                    </ul>
                </li>`;
        });
        
        categoriesContainer.innerHTML = categoriesHTML;
        
        // Add event listeners to category headers
        document.querySelectorAll('.category-header').forEach(categoryHeader => {
            categoryHeader.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-category-id');
                
                if (!categoryId) {
                    console.error('Category ID attribute is missing or undefined');
                    return;
                }
                
                const topicsContainer = document.getElementById(`topics-${categoryId}`);
                const chevronIcon = this.querySelector('.fa-chevron-down, .fa-chevron-up');
                
                // Toggle topics visibility
                if (topicsContainer.style.display === 'none') {
                    // Close all other topic containers
                    document.querySelectorAll('.topics-container').forEach(container => {
                        if (container.id !== `topics-${categoryId}`) {
                            container.style.display = 'none';
                            const otherChevron = container.previousElementSibling.querySelector('.fa-chevron-up');
                            if (otherChevron) {
                                otherChevron.classList.replace('fa-chevron-up', 'fa-chevron-down');
                            }
                        }
                    });
                    
                    // Show this topic container
                    topicsContainer.style.display = 'block';
                    chevronIcon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                    
                    // Fetch topics for this category
                    fetchTopics(categoryId);
                } else {
                    // Hide this topic container
                    topicsContainer.style.display = 'none';
                    chevronIcon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                }
            });
        });
    }

    // Function to fetch topics for a specific category
    function fetchTopics(categoryId) {
        if (!categoryId) {
            console.error('Cannot fetch topics: Category ID is undefined');
            return;
        }
        
        const topicsContainer = document.getElementById(`topics-${categoryId}`);
        
        console.log(`Fetching topics for category ID: ${categoryId}`);
        
        fetch(`/topic/${categoryId}/topics`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(topics => {
                console.log(`Received topics for category ${categoryId}:`, topics);
                displayTopics(categoryId, topics);
            })
            .catch(error => {
                console.error(`Error fetching topics for category ${categoryId}:`, error);
                topicsContainer.innerHTML = `
                    <li class="text-white ps-4">
                        <span><i class="fas fa-exclamation-circle me-2"></i> Error loading topics</span>
                    </li>`;
            });
    }

    // Function to display topics for a category
    function displayTopics(categoryId, topics) {
        const topicsContainer = document.getElementById(`topics-${categoryId}`);
        
        if (!Array.isArray(topics)) {
            console.error('Topics is not an array:', topics);
            topicsContainer.innerHTML = `
                <li class="text-white ps-4">
                    <span class="user-select-none"><i class="fas fa-exclamation-circle me-2"></i> Invalid topics data</span>
                </li>`;
            return;
        }
        
        if (topics.length === 0) {
            topicsContainer.innerHTML = `
                <li class="text-white ps-4">
                    <span class="user-select-none"><i class="fas fa-info-circle me-2"></i> No topics found</span>
                </li>`;
            return;
        }

        let topicsHTML = '';
        
        topics.forEach(topic => {
            // Check the structure of your topic objects and adjust accordingly
            console.log('Topic object:', topic);
            
            // Make sure we're using the correct property name for the ID and title
            const topicId = topic.topicId;
            const topicTitle = topic.name;
            
            if (!topicId) {
                console.error('Topic ID is undefined for:', topic);
                return;
            }
            
            topicsHTML += `
                <li class="nav-item topic-item ps-4 my-1 hover-highlight">
                    <div class="d-flex align-items-center text-white topic-header" data-topic-id="${topicId}">
                        <i class="fas fa-file-alt me-2"></i>
                        <span class="user-select-none">${topicTitle}</span>
                    </div>
                </li>`;
        });
        
        topicsContainer.innerHTML = topicsHTML;
        
        // Add event listeners to topic headers
        topicsContainer.querySelectorAll('.topic-header').forEach(topicHeader => {
            topicHeader.addEventListener('click', function() {
                const topicId = this.getAttribute('data-topic-id');
                
                if (!topicId) {
                    console.error('Topic ID attribute is missing or undefined');
                    return;
                }
                
                // Highlight the selected topic
                document.querySelectorAll('.topic-header').forEach(header => {
                    header.classList.remove('active-topic');
                });
                this.classList.add('active-topic');
                
                // Fetch topic content
                fetchTopicContent(topicId);
            });
        });
    }

 // Function to fetch topic content
function fetchTopicContent(topicId) {
    if (!topicId) {
        console.error('Cannot fetch topic content: Topic ID is undefined');
        return;
    }

    const defaultContent = document.querySelector('.default-content');
    const topicContent = document.querySelector('.topic-content');
    const buttons = document.querySelector('.buttons');

    // Show loading state
    topicContent.innerHTML = `
        <div class="text-center">
            <i class="fas fa-spinner fa-spin fa-3x mb-3"></i>
            <p>Loading content...</p>
        </div>`;
    defaultContent.style.display = 'none';
    topicContent.style.display = 'block';

    console.log(`Fetching content for topic ID: ${topicId}`);

    fetch(`/topic/${topicId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(topic => {
            console.log(`Received content for topic ${topicId}:`, topic);
            displayTopicContent(topic);

            // Show admin buttons
            if (buttons) {
                buttons.style.display = 'flex';
                buttons.classList.add('d-flex');
            }
        })
        .catch(error => {
            console.error(`Error fetching content for topic ${topicId}:`, error);
            topicContent.innerHTML = `
                <div class="text-center text-danger">
                    <i class="fas fa-exclamation-circle fa-3x mb-3"></i>
                    <h3>Error loading content</h3>
                    <p>Could not load the requested topic content. Please try again later.</p>
                </div>`;
        });
}
function toggleAnswer(event) {
    let target = event.currentTarget;  // The clicked element (H4)
    let answerId = target.getAttribute("data-answer-id");
    let answerElement = document.getElementById(answerId);

    if (answerElement) {
        // Toggle between 'none' and 'block'
        if (answerElement.style.display === 'none' || answerElement.style.display === '') {
            answerElement.style.display = 'block';
        } else {
            answerElement.style.display = 'none';
        }
    }
}
let currentTopic = null;
// Function to display topic content
function displayTopicContent(topic) {
    const buttonsContainer = document.querySelector(".buttons");
    const editAssignmentBtn = buttonsContainer.querySelector(".edit-assignment-btn");
    const deleteAssignmentBtn = buttonsContainer.querySelectorAll(".btn-danger")[0];
    const deleteNotesBtn = buttonsContainer.querySelectorAll(".btn-danger")[1];

    
    if (!topic) {
        console.error('Topic object is undefined or null');
        return;
    }
    currentTopic = topic;
    const topicContent = document.querySelector('.topic-content');
    const titleHeading = document.querySelector('.title-heading');
    const buttons = document.querySelector(".buttons");

    // Extracting data with optional chaining
    const title = topic.name || 'Unnamed Topic';
    const categoryName = topic.category?.name || 'Uncategorized';
    const notes = topic.note?.content || [];
    const assignments = topic.assignment || [];
    if (assignments.length > 0) {
        const firstAssignmentId = assignments[0].assignmentId;  // Assuming one assignment for now
        editAssignmentBtn.setAttribute('data-assignment-id', firstAssignmentId);
    } else {
        console.warn("No assignments found for this topic.");
    }
    editAssignmentBtn.addEventListener('click', function () {
        const assignmentId = editAssignmentBtn.getAttribute('data-assignment-id');
        if (!assignmentId) {
            alert("Assignment ID not found!");
            return;
        }

        // Redirect to the Edit Assignment form
        window.location.href = `/editAssignment/${assignmentId}`;
    });

    // Update page title
    if (titleHeading) {
        titleHeading.textContent = title;

    }

    // Format and display topic content
    let htmlContent = `
    <h3 style="color: #5fcf80; text-align:center">Notes:</h3>
    <hr>
    <div class="topic-body">
        <div>
            ${notes.length > 0
                ? notes.map((note, index) => `
                    <div>
                        <h4 style="color: ${index % 2 === 0 ? 'green' : 'black'};">${note}</h4>
                    </div>
                    
                `).join('')
                : '<div>No notes available.</div>'}
        </div>

        <h3 style="color: #5fcf80; margin-top:80px; text-align:center">Assignment:</h3>
        <hr>
        <div>
            ${assignments.length > 0
                ? assignments.map(assignment => `
                    <div>
                        <div>
                            ${assignment.qa.map((qaItem, index) => index % 2 === 0 ? `
                                <h4 style="color: green; cursor: pointer;" class="toggle-answer" data-answer-id="answer-${assignment.assignmentId}-${index}">
                                    <strong>Q${(index / 2) + 1}.</strong> ${qaItem} &#9662;
                                </h4>
                                <div id="answer-${assignment.assignmentId}-${index}" class="answer-text" style="display: none; padding-left: 10px; color: black; text-align:left">
                                    <strong>Answer:</strong> ${assignment.qa[index + 1] ? assignment.qa[index + 1] : 'No answer available'}
                                </div>
                            ` : '').join('')}
                        </div>
                        
                    </div>
                `).join('')
                : '<div>No assignments available.</div>'}
        </div>
    </div>`;


    topicContent.innerHTML = htmlContent;
    document.querySelectorAll('.toggle-answer').forEach(item => {
        item.addEventListener('click', toggleAnswer);
    });
    deleteAssignmentBtn.addEventListener("click", deleteAssignment);
        deleteNotesBtn.addEventListener("click", deleteNote);
}
function deleteAssignment() {
    if (!currentTopic || !Array.isArray(currentTopic.assignment) || currentTopic.assignment.length === 0) {
        alert("No assignment found to delete.");
        return;
    }

    const assignmentId = currentTopic.assignment[0].assignmentId;  // Ensure this ID is valid

    if (!assignmentId) {
        alert("Assignment ID is missing. Cannot delete.");
        return;
    }

    if (confirm("Are you sure you want to delete this assignment?")) {
        fetch(`/delete-assignment/${assignmentId}`, {
            method: "DELETE",
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to delete assignment");
            }
            return response.text();
        })
        .then(message => {
            alert(message);
            location.reload();
        })
        .catch(error => console.error("Error deleting assignment:", error));
    }
}

function deleteNote() {
    console.log("Attempting to delete note...");
    console.log("Current Topic:", currentTopic);

    if (!currentTopic || !currentTopic.note) {
        alert("No note found to delete.");
        return;
    }

    const noteId = currentTopic.note?.noteId; 
    console.log("Note ID:", noteId);

    if (!noteId) {
        alert("Note ID is missing. Cannot delete.");
        return;
    }

    if (confirm("Are you sure you want to delete this note?")) {
        fetch(`/delete-note/${noteId}`, {
            method: "DELETE",
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }
            return response.text();
        })
        .then(message => {
            alert(message);
            location.reload();
        })
        .catch(error => console.error("Error deleting note:", error));
    }
}

// Helper function to format dates
function formatDate(dateString) {
    try {
        const date = new Date(dateString);
        if (isNaN(date.getTime())) {
            return 'Invalid date';
        }
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    } catch (error) {
        console.error('Error formatting date:', error);
        return 'Unknown date';
    }
}

});

   function onEditButtonClick() {
       // Get the active topic ID
       const activeTopic = document.querySelector('.active-topic');
       if (!activeTopic) {
           console.error('No active topic selected');
           return;
       }
       const topicId = activeTopic.getAttribute('data-topic-id');
       if (!topicId) {
           console.error('Active topic ID is missing or undefined');
           return;
       }
       console.log('Edit button clicked for topic ID:', topicId);
       // Redirect to the edit page with the topic ID
       window.location.href = `api/topic/edit/${topicId}`;
   }
  </script>
  


  <!-- Main Content (Shifted Right) -->
  

  <div th:replace="footer :: footer"></div>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Preloader -->
  <div id="preloader"></div>

  <!-- Vendor JS Files -->

    
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

  <!-- Font Awesome (for icons) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>

  <!-- Main JS File -->
  <script src="assets/js/main.js"></script>

</body>
</html>

